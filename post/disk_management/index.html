<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Linux硬盘管理 - Jun's Blog</title><meta name=theme-color><meta name=description content="新增硬盘基本步骤 创建磁盘分区 格式化分区，创建文件系统 挂载到某一目录下 磁盘分区 在Linux中一切皆文件，包括硬盘和分区，他们都位于/dev目录"><meta name=author content="Jun"><link rel="preload stylesheet" as=style href=https://www.junz.org/main.min.css><link rel=preload as=image href=https://www.junz.org/theme.png><script defer src=https://www.junz.org/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.junz.org/favicon.ico><link rel=apple-touch-icon href=https://www.junz.org/apple-touch-icon.png><meta name=generator content="Hugo 0.119.0"><meta itemprop=name content="Linux硬盘管理"><meta itemprop=description content="新增硬盘基本步骤 创建磁盘分区 格式化分区，创建文件系统 挂载到某一目录下 磁盘分区 在Linux中一切皆文件，包括硬盘和分区，他们都位于/dev目录"><meta itemprop=datePublished content="2021-02-28T15:38:05+08:00"><meta itemprop=dateModified content="2021-02-28T15:38:05+08:00"><meta itemprop=wordCount content="2096"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux硬盘管理"><meta name=twitter:description content="新增硬盘基本步骤 创建磁盘分区 格式化分区，创建文件系统 挂载到某一目录下 磁盘分区 在Linux中一切皆文件，包括硬盘和分区，他们都位于/dev目录"><link rel=canonical href=https://www.junz.org/post/disk_management/></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=https://www.junz.org>Jun's Blog</a><div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/>Home</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/about/>About</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"><article><header class=mb-16><h1 class="!my-0 pb-2.5">Linux硬盘管理</h1><div class="text-sm antialiased opacity-60"><time>Feb 28, 2021</time>
<span class=mx-1>&#183;</span>
<span>Jun</span></div></header><section><h2 id=新增硬盘基本步骤>新增硬盘基本步骤</h2><ol><li>创建磁盘分区</li><li>格式化分区，创建文件系统</li><li>挂载到某一目录下</li></ol><h2 id=磁盘分区>磁盘分区</h2><p>在Linux中一切皆文件，包括硬盘和分区，他们都位于<code>/dev</code>目录下。</p><h3 id=各种接口的磁盘在linux中的名称>各种接口的磁盘在Linux中的名称</h3><ul><li>/dev/sd[a-p]1-15为SCSI, SATA, U盘, Flash闪盘等接口的磁盘文件名</li><li>/dev/hd[a-d]1-30为 IDE 接口的磁盘文件名</li></ul><h3 id=分区的目的>分区的目的</h3><ul><li>提升数据的安全性(一个分区的数据损坏不会影响其他分区的数据)</li><li>支持安装多个操作系统</li></ul><h3 id=分区种类>分区种类</h3><p>可以用 <code>sudo fdisk -l</code> 查看</p><ul><li><code>MBR</code><ul><li>由主分区、扩展分区和逻辑分区组成。</li><li>主分区的最大个数为4</li><li>扩展分区也是一个主分区，并且最多只能有一个扩展分区。</li><li>对于逻辑分区，Linux 规定它们必须建立在扩展分区上。</li></ul></li><li><code>GPT</code><ul><li><code>GPT</code>头</li><li>分区表（在最开头，仍然存储了一份传统的<code>MBR</code>，以向后兼容）</li><li><code>GPT</code>分区</li><li>备份区</li></ul></li></ul><h3 id=注意点>注意点</h3><ul><li>如果使用GRUB legacy作为bootloader，必须使用<code>MBR</code>。</li><li>如果使用传统的BIOS，并且双启动中包含 Windows ，必须使用<code>MBR</code>。</li><li>如果使用 UEFI 而不是BIOS，并且双启动中包含 Windows 64位版，必须使用<code>GPT</code>。</li><li>没有限制的情况下，优先选择 <code>GPT</code>。</li></ul><h2 id=文件系统>文件系统</h2><p>磁盘分区后应该进行格式化，然后操作系统才能使用此分区</p><h3 id=linux-vfs-virtual-filesystem-switch>Linux VFS (Virtual Filesystem Switch)</h3><p>磁盘的各个分区可以有各自的文件系统，Linux的内核则通过<code>VFS</code>去读取文件系统</p><h3 id=文件系统种类>文件系统种类</h3><h4 id=ext文件系统>ext文件系统</h4><ul><li><code>inode</code> 负责存放文件权限(<code>rwx</code>)与文件属性(拥有者、群组、时间参数等）</li><li><code>data block</code> 负责存放实际数据</li><li><code>superblock</code> 记录整体信息，包括<code>inode/block</code>的总量、使用量、剩余量，以及文件系统的格式与相关信息等</li></ul><h4 id=xfs文件系统>xfs文件系统</h4><ul><li>data section</li><li>log section</li><li>realtime section</li></ul><h4 id=vfat文件系统>vfat文件系统</h4><h4 id=windows与linux都可以识别可以用来共享数据>windows与Linux都可以识别，可以用来共享数据</h4><h2 id=挂载>挂载</h2><p>在一个区被格式化为一个文件系统之后，这个时候Linux操作系统还找不到它，我们还需要把这个文件系统注册进Linux操作系统的文件体系里，这个过程称为挂载。</p><p><strong>挂载点必须是目录</strong></p><p>注意</p><ul><li>根目录必须挂载，且最先挂载</li><li>所有分区在同一时间只能挂载一次</li><li>卸载文件系统时，必须位于其挂载目录</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mount 分区名 目录挂载点
</span></span><span class=line><span class=cl>mount -a //挂载所有文件系统
</span></span><span class=line><span class=cl>mount -t //指定文件系统种类
</span></span><span class=line><span class=cl>mount -n //挂载但不将其写入/etc/fstab中
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>unmount -f 分区名或挂载点//强制卸载
</span></span><span class=line><span class=cl>unmount -n //不将改变写入/etc/mtab
</span></span></code></pre></td></tr></table></div></div><h3 id=开机挂载设置>开机挂载设置</h3><p>Linux在开机时进行自动挂载文件系统，相关配置文件在<code>/etc/fstab</code>中．</p><p>配置文件文件结构</p><p>-　设备/UUID
-　挂载点
-　文件系统
-　文件系统的参数
　　-　 <code>auto/noauto</code>当执行<code>mount -a</code>时，此文件系统会被自动挂载
　　- 　<code>rw/ro</code>使文件系统以可读写或者只读的方式挂载上来</p><ul><li>是否用<code>fsck</code>检查分区（现在直接填０即可）</li></ul><h2 id=基本命令>基本命令</h2><h3 id=分区管理>分区管理</h3><ul><li><p><code>fdisk</code>(主要支持<code>MBR</code>)</p></li><li><p><code>parted</code>(既支持<code>MBR</code>也支持<code>GPT</code>)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>parted 硬盘名 命令
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>常用命令：
</span></span><span class=line><span class=cl>新建分区 mkpart [primary|logical|extend] [ext4|vfat|xfs] start end
</span></span><span class=line><span class=cl>显示分区 print
</span></span><span class=line><span class=cl>删除分区 rm [partion]
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=格式化文件系统>格式化文件系统</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkfs -t 文件系统种类 分区名
</span></span></code></pre></td></tr></table></div></div><h3 id=磁盘检查>磁盘检查</h3><p><strong>不要随意使用此命令！</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>fsck [-t 文件系统] [-ACay] 分区名称
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-t  ：指定文件系统
</span></span><span class=line><span class=cl>-a  ：自动修复检查到的有问题的分区
</span></span><span class=line><span class=cl>-C  ：显示目前的进度
</span></span></code></pre></td></tr></table></div></div><h3 id=创建swap分区>创建swap分区</h3><ul><li>对硬盘进行分区<ul><li>新建分区</li><li>将ID改为82（swap的识别码）</li><li>写入更改后让内核升级 partition table 执行<code>partprobe</code></li></ul></li><li>创建swap的文件系统 <code>mkswap 分区名</code></li></ul><h2 id=lvm>LVM</h2><h3 id=基本概念>基本概念</h3><h4 id=物理卷pvphysical-volume>物理卷——PV（Physical Volume）</h4><p>physical volume对应底层的物理硬盘或者物理分区</p><p>需要将实际分区或者硬盘的系统识别码改为<code>8e</code>才能创建physical volume</p><p>相关命令</p><ul><li><code>pvcreate</code>创建physical volume</li><li><code>pvscan</code>扫描系统中所有的physical volume</li><li><code>pvdisplay</code>显示目前系统上面的physical volume 状态</li><li><code>pvremove</code>移除physical volume的属性</li></ul><h4 id=卷组vgvolume-group>卷组——VG（Volume Group）</h4><p>相关命令</p><ul><li><code>vgcreate</code>创建一个volume group <code>vgcreate -s 100G VG_NAME PV_NAME</code></li><li><code>vgextend</code>在volume group内增加physical volume</li><li><code>vgreduce</code>在volume group内删除physical volume</li><li><code>vgremove</code>删除volume group</li></ul><h4 id=逻辑卷lvlogical-volume>逻辑卷——LV（Logical Volume）</h4><p>logical volume不同于volume group，必须使用全名，如<code>/dev/vg_test/lv_test</code></p><p>相当于一个文件系统，可以被格式化。</p><p>相关命令</p><ul><li><code>lvcreate</code>创建logical volume <code>lvcreate -L 10G -n LV_NAME VG_NAME</code></li><li><code>lvextend</code>在logical volume内增加容量</li><li><code>lvreduce</code>在logical volume内删除容量</li><li><code>lvremove</code>删除一个logical volume</li><li><code>lvresize</code>调整logical volume的大小 <code>lvresize -L +10G /dev/vg_test/lv_test</code></li></ul><h3 id=底层原理>底层原理</h3><h3 id=pephysical-extent>PE（Physical Extent）</h3><p>创建 physical volume时，在逻辑上把物理存储介质划分为了 N 个大小相同的块。可以使用<code>pvdisplay</code>查看详细信息。</p><h3 id=lelogical-extent>LE（Logical Extent）</h3><p>底层也是划分为若干个大小相同的块，一般情况下，LE 与 PE 一一对应。</p><h3 id=lvm-快照>LVM 快照</h3><p>假设需要备份的原始LV为<code>/dev/vg_raw/lv_raw</code></p><p>备份快照名称为<code>/dev/vg_raw/vg_snapshot</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/lvcreate -s -l 5G -n vg_snapshot /dev/vg_raw/lv_raw
</span></span></code></pre></td></tr></table></div></div><p><strong>因为在XFS文件系统中不允许相同UUID的文件系统的挂载，所以要加上<code>nouuid</code>这个参数</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>xfsdump -l 0 -L lvm1 -M lvm1 -f /home/lvm.dump /srv/snapshot
</span></span></code></pre></td></tr></table></div></div></section><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]"><a class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://www.junz.org/post/file_directory/><span class=mr-1.5>←</span><span>Linux文件与目录</span></a>
<a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://www.junz.org/post/daemons/><span>Linux服务浅谈</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://www.junz.org>Jun's Blog</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>✎ Paper</a></footer></body></html>